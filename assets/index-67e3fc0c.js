function F(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var S=x;function x(e,n,t,r){var o,i,s,c,a,l,g,d,h,M,u,f,v,D;for(typeof n!="function"&&(r=t,t=n,n=null),r=r||{},c=r.tolerance===void 0?1e-7:r.tolerance,D=r.epsilon===void 0?2220446049250313e-31:r.epsilon,a=r.maxIterations===void 0?20:r.maxIterations,u=r.h===void 0?1e-4:r.h,v=r.verbose===void 0?!1:r.verbose,f=1/u,l=0;l++<a;){if(i=e(t),n?s=n(t):(g=e(t+u),d=e(t-u),h=e(t+2*u),M=e(t-2*u),s=(M-h+8*(g-d))*f/12),Math.abs(s)<=D*Math.abs(i))return v&&console.log("Newton-Raphson: failed to converged due to nearly zero first derivative"),!1;if(o=t-i/s,Math.abs(o-t)<=c*Math.abs(o))return v&&console.log("Newton-Raphson: converged to x = "+o+" after "+l+" iterations"),o;t=o}return v&&console.log("Newton-Raphson: Maximum iterations reached ("+a+")"),!1}var P=S,N=1e3*60*60*24,T=365;function O(e){if(!e||!e.length||!e.forEach||e.length<2)throw new Error("Argument is not an array with length of 2 or more.");var n=[],t=Math.floor(e[0].when/N),r=t,o=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,s=0,c=0;if(e.forEach(function(a){s+=a.amount,a.amount<0&&(c+=-a.amount);var l=Math.floor(a.when/N);t=Math.min(t,l),r=Math.max(r,l),o=Math.min(o,a.amount),i=Math.max(i,a.amount),n.push({amount:a.amount,epochDays:l})}),t===r)throw new Error("Transactions must not all be on the same day.");if(o>=0)throw new Error("Transactions must not all be nonnegative.");if(i<0)throw new Error("Transactions must not all be negative.");return n.forEach(function(a){a.years=(r-a.epochDays)/T}),{total:s,deposits:c,days:r-t,investments:n,maxAmount:i}}function k(e,n){var t=O(e);if(t.maxAmount===0)return-1;var r=t.investments,o=function(a){return r.reduce(function(l,g){var d=g.amount,h=g.years;return-1<a?l+d*Math.pow(1+a,h):a<-1?l-Math.abs(d)*Math.pow(-1-a,h):h===0?l+d:l},0)},i=function(a){return r.reduce(function(l,g){var d=g.amount,h=g.years;return h===0?l:-1<a?l+d*h*Math.pow(1+a,h-1):a<-1?l+Math.abs(d)*h*Math.pow(-1-a,h-1):l},0)},s=n?n.guess:void 0;if(s&&isNaN(s))throw new Error("option.guess must be a number.");s||(s=t.total/t.deposits/(t.days/T));var c=P(o,i,s,n);if(c===!1)throw new Error("Newton-Raphson algorithm failed to converge.");return c}var C=k,L=F(C);const j=1e3*60*60*24;function q(e){if(e.length<2)return!0;const n=[...e].sort((t,r)=>t.date.getTime()-r.date.getTime());for(let t=1;t<n.length;t++){const r=n[t-1].date;if((n[t].date.getTime()-r.getTime())/j!==1)return!1}return!0}function z(e,n){const t=new Date(e),r=t.getDate();return t.setMonth(t.getMonth()-n),t.getDate()<r&&t.setDate(0),t}function G(e){if(e.length===0)return[];const n=[...e].sort((s,c)=>s.date.getTime()-c.date.getTime()),t=[];let r=0,o=new Date(n[0].date);const i=n[n.length-1].date;for(;o<=i;)r<n.length&&K(o,n[r].date)?(t.push({date:new Date(o),nav:n[r].nav}),r++):t.push({date:new Date(o),nav:n[r].nav}),o.setDate(o.getDate()+1);return t}function K(e,n){return e.getFullYear()===n.getFullYear()&&e.getMonth()===n.getMonth()&&e.getDate()===n.getDate()}function w(e){return e.toISOString().split("T")[0]}function U(e){return new Map(e.map(n=>[w(n.date),n]))}function B(e,n=1,t=[],r=100){if(e.length===0||e.some(u=>u.length<2))return[];const o=e.length,i=t.length===o?t:Array(o).fill(100/o),s=e.map(u=>{let f=u;return q(f)||(f=G(f)),f}),c=s.map(U),a=[...s[0]].sort((u,f)=>u.date.getTime()-f.date.getTime()),l=a.map(u=>u.date),g=[],d=l[0],h=12*n,M=new Map;a.forEach((u,f)=>{M.set(w(u.date),f)});for(let u=0;u<l.length;u++){const f=l[u],v=z(f,h);if(v<d||(M.get(w(v))??-1)===-1)continue;const E=[];let y=!0;for(let m=0;m<o;m++){const p=c[m].get(w(v));if(!p){y=!1;break}const Y=r*i[m]/100;E[m]=Y/p.nav}if(!y)continue;let I=0;for(let m=0;m<o;m++){const p=c[m].get(w(f));if(!p){y=!1;break}I+=E[m]*p.nav}if(!y)continue;const A=[{amount:-r,when:v},{amount:I,when:f}],R=[{nav:r,when:v},{nav:I,when:f}];let b;try{b=L(A)}catch{continue}const _=X(c,E,a,v,f),V=$(_);g.push({date:f,xirr:b,transactions:R,volatility:Math.round(V*1e4)/1e4})}return g}function X(e,n,t,r,o){const i=e.length,s=[],c=t.filter(a=>a.date>=r&&a.date<=o);for(const a of c){let l=0,g=!0;for(let d=0;d<i;d++){const h=e[d].get(w(a.date));if(!h){g=!1;break}l+=n[d]*h.nav}g&&l>0&&s.push({date:a.date,totalValue:l})}return s}function $(e){if(e.length<2)return 0;const n=[];for(let i=1;i<e.length;i++){const s=e[i-1].totalValue,c=e[i].totalValue;if(s>0){const a=c/s-1;n.push(a)}}if(n.length<2)return 0;const t=n.reduce((i,s)=>i+s,0)/n.length,r=n.reduce((i,s)=>i+Math.pow(s-t,2),0)/n.length;return Math.sqrt(r)*Math.sqrt(252)*100}export{B as calculateLumpSumRollingXirr};
//# sourceMappingURL=index-67e3fc0c.js.map
