function F(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var V=S;function S(e,n,t,r){var o,i,s,c,a,l,d,h,f,g,u,m,M,w;for(typeof n!="function"&&(r=t,t=n,n=null),r=r||{},c=r.tolerance===void 0?1e-7:r.tolerance,w=r.epsilon===void 0?2220446049250313e-31:r.epsilon,a=r.maxIterations===void 0?20:r.maxIterations,u=r.h===void 0?1e-4:r.h,M=r.verbose===void 0?!1:r.verbose,m=1/u,l=0;l++<a;){if(i=e(t),n?s=n(t):(d=e(t+u),h=e(t-u),f=e(t+2*u),g=e(t-2*u),s=(g-f+8*(d-h))*m/12),Math.abs(s)<=w*Math.abs(i))return M&&console.log("Newton-Raphson: failed to converged due to nearly zero first derivative"),!1;if(o=t-i/s,Math.abs(o-t)<=c*Math.abs(o))return M&&console.log("Newton-Raphson: converged to x = "+o+" after "+l+" iterations"),o;t=o}return M&&console.log("Newton-Raphson: Maximum iterations reached ("+a+")"),!1}var x=V,b=1e3*60*60*24,N=365;function P(e){if(!e||!e.length||!e.forEach||e.length<2)throw new Error("Argument is not an array with length of 2 or more.");var n=[],t=Math.floor(e[0].when/b),r=t,o=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,s=0,c=0;if(e.forEach(function(a){s+=a.amount,a.amount<0&&(c+=-a.amount);var l=Math.floor(a.when/b);t=Math.min(t,l),r=Math.max(r,l),o=Math.min(o,a.amount),i=Math.max(i,a.amount),n.push({amount:a.amount,epochDays:l})}),t===r)throw new Error("Transactions must not all be on the same day.");if(o>=0)throw new Error("Transactions must not all be nonnegative.");if(i<0)throw new Error("Transactions must not all be negative.");return n.forEach(function(a){a.years=(r-a.epochDays)/N}),{total:s,deposits:c,days:r-t,investments:n,maxAmount:i}}function O(e,n){var t=P(e);if(t.maxAmount===0)return-1;var r=t.investments,o=function(a){return r.reduce(function(l,d){var h=d.amount,f=d.years;return-1<a?l+h*Math.pow(1+a,f):a<-1?l-Math.abs(h)*Math.pow(-1-a,f):f===0?l+h:l},0)},i=function(a){return r.reduce(function(l,d){var h=d.amount,f=d.years;return f===0?l:-1<a?l+h*f*Math.pow(1+a,f-1):a<-1?l+Math.abs(h)*f*Math.pow(-1-a,f-1):l},0)},s=n?n.guess:void 0;if(s&&isNaN(s))throw new Error("option.guess must be a number.");s||(s=t.total/t.deposits/(t.days/N));var c=x(o,i,s,n);if(c===!1)throw new Error("Newton-Raphson algorithm failed to converge.");return c}var k=O,C=F(k);const L=1e3*60*60*24;function j(e){if(e.length<2)return!0;const n=[...e].sort((t,r)=>t.date.getTime()-r.date.getTime());for(let t=1;t<n.length;t++){const r=n[t-1].date;if((n[t].date.getTime()-r.getTime())/L!==1)return!1}return!0}function q(e,n){const t=new Date(e),r=t.getDate();return t.setMonth(t.getMonth()-n),t.getDate()<r&&t.setDate(0),t}function z(e){if(e.length===0)return[];const n=[...e].sort((s,c)=>s.date.getTime()-c.date.getTime()),t=[];let r=0,o=new Date(n[0].date);const i=n[n.length-1].date;for(;o<=i;)r<n.length&&G(o,n[r].date)?(t.push({date:new Date(o),nav:n[r].nav}),r++):t.push({date:new Date(o),nav:n[r].nav}),o.setDate(o.getDate()+1);return t}function G(e,n){return e.getFullYear()===n.getFullYear()&&e.getMonth()===n.getMonth()&&e.getDate()===n.getDate()}function y(e){return e.toISOString().split("T")[0]}function K(e){return new Map(e.map(n=>[y(n.date),n]))}function $(e,n=1,t=[],r=100){if(e.length===0||e.some(g=>g.length<2))return[];const o=e.length,i=t.length===o?t:Array(o).fill(100/o),s=e.map(g=>{let u=g;return j(u)||(u=z(u)),u}),c=s.map(K),a=[...s[0]].sort((g,u)=>g.date.getTime()-u.date.getTime()),l=a.map(g=>g.date),d=[],h=l[0],f=12*n;for(let g=0;g<l.length;g++){const u=l[g],m=q(u,f);if(m<h||a.findIndex(v=>v.date.getFullYear()===m.getFullYear()&&v.date.getMonth()===m.getMonth()&&v.date.getDate()===m.getDate())===-1)continue;const w=[];let p=!0;for(let v=0;v<o;v++){const D=c[v].get(y(m));if(!D){p=!1;break}const _=r*i[v]/100;w[v]=_/D.nav}if(!p)continue;let E=0;for(let v=0;v<o;v++){const D=c[v].get(y(u));if(!D){p=!1;break}E+=w[v]*D.nav}if(!p)continue;const T=[{amount:-r,when:m},{amount:E,when:u}],A=[{nav:r,when:m},{nav:E,when:u}];let I;try{I=C(T)}catch{continue}const R=U(c,w,a,m,u),Y=X(R);d.push({date:u,xirr:I,transactions:A,volatility:Math.round(Y*1e4)/1e4})}return d}function U(e,n,t,r,o){const i=e.length,s=[],c=t.filter(a=>a.date>=r&&a.date<=o);for(const a of c){let l=0,d=!0;for(let h=0;h<i;h++){const f=e[h].get(y(a.date));if(!f){d=!1;break}l+=n[h]*f.nav}d&&l>0&&s.push({date:a.date,totalValue:l})}return s}function X(e){if(e.length<2)return 0;const n=[];for(let i=1;i<e.length;i++){const s=e[i-1].totalValue,c=e[i].totalValue;if(s>0){const a=c/s-1;n.push(a)}}if(n.length<2)return 0;const t=n.reduce((i,s)=>i+s,0)/n.length,r=n.reduce((i,s)=>i+Math.pow(s-t,2),0)/n.length;return Math.sqrt(r)*Math.sqrt(252)*100}export{$ as calculateLumpSumRollingXirr};
//# sourceMappingURL=index-ffe347d8.js.map
