function Y(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var F=x;function x(t,e,n,r){var o,l,s,u,a,i,h,f,c,m,g,y,v,d;for(typeof e!="function"&&(r=n,n=e,e=null),r=r||{},u=r.tolerance===void 0?1e-7:r.tolerance,d=r.epsilon===void 0?2220446049250313e-31:r.epsilon,a=r.maxIterations===void 0?20:r.maxIterations,g=r.h===void 0?1e-4:r.h,v=r.verbose===void 0?!1:r.verbose,y=1/g,i=0;i++<a;){if(l=t(n),e?s=e(n):(h=t(n+g),f=t(n-g),c=t(n+2*g),m=t(n-2*g),s=(m-c+8*(h-f))*y/12),Math.abs(s)<=d*Math.abs(l))return v&&console.log("Newton-Raphson: failed to converged due to nearly zero first derivative"),!1;if(o=n-l/s,Math.abs(o-n)<=u*Math.abs(o))return v&&console.log("Newton-Raphson: converged to x = "+o+" after "+i+" iterations"),o;n=o}return v&&console.log("Newton-Raphson: Maximum iterations reached ("+a+")"),!1}var K=F,D=1e3*60*60*24,I=365;function O(t){if(!t||!t.length||!t.forEach||t.length<2)throw new Error("Argument is not an array with length of 2 or more.");var e=[],n=Math.floor(t[0].when/D),r=n,o=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY,s=0,u=0;if(t.forEach(function(a){s+=a.amount,a.amount<0&&(u+=-a.amount);var i=Math.floor(a.when/D);n=Math.min(n,i),r=Math.max(r,i),o=Math.min(o,a.amount),l=Math.max(l,a.amount),e.push({amount:a.amount,epochDays:i})}),n===r)throw new Error("Transactions must not all be on the same day.");if(o>=0)throw new Error("Transactions must not all be nonnegative.");if(l<0)throw new Error("Transactions must not all be negative.");return e.forEach(function(a){a.years=(r-a.epochDays)/I}),{total:s,deposits:u,days:r-n,investments:e,maxAmount:l}}function C(t,e){var n=O(t);if(n.maxAmount===0)return-1;var r=n.investments,o=function(a){return r.reduce(function(i,h){var f=h.amount,c=h.years;return-1<a?i+f*Math.pow(1+a,c):a<-1?i-Math.abs(f)*Math.pow(-1-a,c):c===0?i+f:i},0)},l=function(a){return r.reduce(function(i,h){var f=h.amount,c=h.years;return c===0?i:-1<a?i+f*c*Math.pow(1+a,c-1):a<-1?i+Math.abs(f)*c*Math.pow(-1-a,c-1):i},0)},s=e?e.guess:void 0;if(s&&isNaN(s))throw new Error("option.guess must be a number.");s||(s=n.total/n.deposits/(n.days/I));var u=K(o,l,s,e);if(u===!1)throw new Error("Newton-Raphson algorithm failed to converge.");return u}var z=C,U=Y(z);const X=1e3*60*60*24;function j(t){if(t.length<2)return!0;const e=[...t].sort((n,r)=>n.date.getTime()-r.date.getTime());for(let n=1;n<e.length;n++){const r=e[n-1].date;if((e[n].date.getTime()-r.getTime())/X!==1)return!1}return!0}function V(t,e){const n=new Date(t),r=n.getDate();return n.setMonth(n.getMonth()-e),n.getDate()<r&&n.setDate(0),n}function q(t){if(t.length===0)return[];const e=[...t].sort((s,u)=>s.date.getTime()-u.date.getTime()),n=[];let r=0,o=new Date(e[0].date);const l=e[e.length-1].date;for(;o<=l;)r<e.length&&G(o,e[r].date)?(n.push({date:new Date(o),nav:e[r].nav}),r++):n.push({date:new Date(o),nav:e[r].nav}),o.setDate(o.getDate()+1);return n}function G(t,e){return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()}const L=252;function $(t){if(t.length<2)return 0;const e=k(t);if(e.length<2)return 0;const n=e.reduce((u,a)=>u+a,0)/e.length,r=e.reduce((u,a)=>{const i=a-n;return u+i*i},0)/e.length;return Math.sqrt(r)*Math.sqrt(L)*100||0}function k(t){const e=[];for(let n=1;n<t.length;n++){const r=t[n-1].totalValue,o=t[n].totalValue;if(r>0){const l=o/r-1;e.push(l)}}return e}function B(t){const e=H(t);return $(e)}function H(t){const e=new Map;for(const n of t){const r=n.when.toISOString().split("T")[0],o=e.get(r)||0;e.set(r,o+n.currentValue)}return Array.from(e.entries()).sort((n,r)=>n[0].localeCompare(r[0])).map(([n,r])=>({date:new Date(n),totalValue:r}))}function w(t){return t.toISOString().split("T")[0]}function N(t){return new Map(t.map(e=>[w(e.date),e]))}function A(t){return j(t)?t:q(t)}function b(t){return t.length>0&&t.every(e=>e.length>=2)}function R(t){return[...t].sort((e,n)=>e.date.getTime()-n.date.getTime())}function Z(t,e=1,n=[],r=100,o=!1){if(!b(t))return[];const l=t.length,s=n.length===l?n:Array(l).fill(100/l),u=t.map(A),a=u.map(N),i=R(u[0]),h=i[0].date,f=e*12;return i.flatMap(c=>J(c.date,a,i,h,f,s,r,o))}function J(t,e,n,r,o,l,s,u){const a=V(t,o);if(a<r)return[];const i=_(e,a,l,s);if(!i)return[];const h=Q(e,t,i);if(h===null)return[];const f=W(s,h,a,t);if(f===null)return[];const c=S(e,i,l,n,a,t,s),m=B(c),g=u?c:c.filter(y=>y.type!=="nil");return[{date:t,xirr:Math.round(f*1e4)/1e4,transactions:g,volatility:Math.round(m*1e4)/1e4}]}function _(t,e,n,r){const o=[],l=w(e);for(let s=0;s<t.length;s++){const u=t[s].get(l);if(!u)return null;const a=r*n[s]/100;o[s]=a/u.nav}return o}function Q(t,e,n){let r=0;const o=w(e);for(let l=0;l<t.length;l++){const s=t[l].get(o);if(!s)return null;r+=n[l]*s.nav}return r}function W(t,e,n,r){try{return U([{amount:-t,when:n},{amount:e,when:r}])}catch{return null}}function S(t,e,n,r,o,l,s){const u=[],a=w(o),i=w(l),h=r.filter(f=>f.date>=o&&f.date<=l);for(const f of h){const c=w(f.date),m=c===a,g=c===i;let y=0;const v=[];for(let d=0;d<t.length;d++){const p=t[d].get(c);if(!p)continue;const M=e[d]*p.nav;y+=M;const P=s*n[d]/100;let E="nil",T=0;m?(E="buy",T=-P):g&&(E="sell",T=M),v.push({fundIdx:d,nav:p.nav,when:p.date,units:e[d],amount:T,type:E,cumulativeUnits:e[d],currentValue:M,allocationPercentage:0})}v.forEach(d=>{d.allocationPercentage=y>0?d.currentValue/y*100:0}),u.push(...v)}return u}function tt(t,e,n,r,o=100){if(!b(t))return null;const l=t.length,s=r.length===l?r:Array(l).fill(100/l),u=t.map(A),a=u.map(N),i=R(u[0]),h=i[0].date,f=n*12,c=V(e,f);if(c<h)return null;const m=_(a,c,s,o);return m?S(a,m,s,i,c,e,o):null}export{Z as calculateLumpSumRollingXirr,tt as recalculateLumpsumTransactionsForDate};
//# sourceMappingURL=index-842b9c16.js.map
