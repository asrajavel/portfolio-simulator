function B(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var k=H;function H(t,e,n,r){var s,a,l,u,c,i,d,f,o,v,g,p,m,h;for(typeof e!="function"&&(r=n,n=e,e=null),r=r||{},u=r.tolerance===void 0?1e-7:r.tolerance,h=r.epsilon===void 0?2220446049250313e-31:r.epsilon,c=r.maxIterations===void 0?20:r.maxIterations,g=r.h===void 0?1e-4:r.h,m=r.verbose===void 0?!1:r.verbose,p=1/g,i=0;i++<c;){if(a=t(n),e?l=e(n):(d=t(n+g),f=t(n-g),o=t(n+2*g),v=t(n-2*g),l=(v-o+8*(d-f))*p/12),Math.abs(l)<=h*Math.abs(a))return m&&console.log("Newton-Raphson: failed to converged due to nearly zero first derivative"),!1;if(s=n-a/l,Math.abs(s-n)<=u*Math.abs(s))return m&&console.log("Newton-Raphson: converged to x = "+s+" after "+i+" iterations"),s;n=s}return m&&console.log("Newton-Raphson: Maximum iterations reached ("+c+")"),!1}var J=k,Y=1e3*60*60*24,x=365;function Q(t){if(!t||!t.length||!t.forEach||t.length<2)throw new Error("Argument is not an array with length of 2 or more.");var e=[],n=Math.floor(t[0].when/Y),r=n,s=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=0,u=0;if(t.forEach(function(c){l+=c.amount,c.amount<0&&(u+=-c.amount);var i=Math.floor(c.when/Y);n=Math.min(n,i),r=Math.max(r,i),s=Math.min(s,c.amount),a=Math.max(a,c.amount),e.push({amount:c.amount,epochDays:i})}),n===r)throw new Error("Transactions must not all be on the same day.");if(s>=0)throw new Error("Transactions must not all be nonnegative.");if(a<0)throw new Error("Transactions must not all be negative.");return e.forEach(function(c){c.years=(r-c.epochDays)/x}),{total:l,deposits:u,days:r-n,investments:e,maxAmount:a}}function W(t,e){var n=Q(t);if(n.maxAmount===0)return-1;var r=n.investments,s=function(c){return r.reduce(function(i,d){var f=d.amount,o=d.years;return-1<c?i+f*Math.pow(1+c,o):c<-1?i-Math.abs(f)*Math.pow(-1-c,o):o===0?i+f:i},0)},a=function(c){return r.reduce(function(i,d){var f=d.amount,o=d.years;return o===0?i:-1<c?i+f*o*Math.pow(1+c,o-1):c<-1?i+Math.abs(f)*o*Math.pow(-1-c,o-1):i},0)},l=e?e.guess:void 0;if(l&&isNaN(l))throw new Error("option.guess must be a number.");l||(l=n.total/n.deposits/(n.days/x));var u=J(s,a,l,e);if(u===!1)throw new Error("Newton-Raphson algorithm failed to converge.");return u}var Z=W,U=B(Z);const tt=1e3*60*60*24;function et(t){if(t.length<2)return!0;const e=[...t].sort((n,r)=>n.date.getTime()-r.date.getTime());for(let n=1;n<e.length;n++){const r=e[n-1].date;if((e[n].date.getTime()-r.getTime())/tt!==1)return!1}return!0}function K(t,e){const n=new Date(t),r=n.getDate();return n.setMonth(n.getMonth()-e),n.getDate()<r&&n.setDate(0),n}function nt(t){if(t.length===0)return[];const e=[...t].sort((l,u)=>l.date.getTime()-u.date.getTime()),n=[];let r=0,s=new Date(e[0].date);const a=e[e.length-1].date;for(;s<=a;)r<e.length&&rt(s,e[r].date)?(n.push({date:new Date(s),nav:e[r].nav}),r++):n.push({date:new Date(s),nav:e[r].nav}),s.setDate(s.getDate()+1);return n}function rt(t,e){return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()}const ot=252;function at(t){if(t.length<2)return 0;const e=lt(t);if(e.length<2)return 0;const n=e.reduce((d,f)=>d+f,0)/e.length,r=e.reduce((d,f)=>{const o=f-n;return d+o*o},0)/e.length,s=Math.sqrt(r),a=t.length-1,l=e.length,u=a>0?Math.round(l/a*365):ot;return s*Math.sqrt(u)*100||0}function lt(t){const e=[];for(let n=1;n<t.length;n++){const r=t[n-1].totalValue,s=t[n].totalValue;if(r>0){if(s===r)continue;const a=s/r-1;e.push(a)}}return e}function w(t){return t.toISOString().split("T")[0]}function C(t){return new Map(t.map(e=>[w(e.date),e]))}function O(t){return et(t)?t:nt(t)}function $(t){return t.length>0&&t.every(e=>e.length>=2)}function j(t){return[...t].sort((e,n)=>e.date.getTime()-n.date.getTime())}let b=0,P=0,R=0;function ft(t,e=1,n=[],r=100,s=!1){if(b=0,P=0,R=0,!$(t))return[];const a=t.length,l=n.length===a?n:Array(a).fill(100/a),u=t.map(O),c=u.map(C),i=j(u[0]),d=i[0].date,f=e*12,o=new Map;i.forEach((m,h)=>{o.set(w(m.date),h)});const v=performance.now(),g=[];for(const m of i){const h=w(m.date),y=[];for(let M=0;M<a;M++){const D=c[M].get(h);y.push((D==null?void 0:D.nav)??0)}g.push(y)}R=performance.now()-v;const p=[];for(let m=0;m<i.length;m++){const h=i[m].date,y=K(h,f);if(y<d)continue;const M=w(y),D=o.get(M);if(D===void 0)continue;const T=z(c,y,l,r);if(!T)continue;const E=ct(c,h,T);if(E===null)continue;const N=performance.now(),A=it(r,E,y,h);if(b+=performance.now()-N,A===null)continue;const X=performance.now(),_=g[D],S=[];for(let V=D;V<=m;V++){const L=g[V];let F=0;for(let I=0;I<a;I++)_[I]>0&&(F+=l[I]/100*(L[I]/_[I])*r);S.push({date:i[V].date,totalValue:F})}const q=at(S);P+=performance.now()-X;const G=st(c,T,l,y,h,r);p.push({date:h,xirr:Math.round(A*1e4)/1e4,transactions:G,volatility:Math.round(q*1e4)/1e4})}return console.log(`[Lumpsum Calc] Precompute: ${(R/1e3).toFixed(2)}s | XIRR: ${(b/1e3).toFixed(2)}s | Volatility: ${(P/1e3).toFixed(2)}s | Total entries: ${p.length}`),p}function st(t,e,n,r,s,a){const l=[],u=w(r),c=w(s);let i=0;for(let o=0;o<t.length;o++){const v=t[o].get(u);if(!v)continue;const g=e[o]*v.nav;i+=g;const p=a*n[o]/100;l.push({fundIdx:o,nav:v.nav,when:v.date,units:e[o],amount:-p,type:"buy",cumulativeUnits:e[o],currentValue:g,allocationPercentage:0})}let d=0;const f=[];for(let o=0;o<t.length;o++){const v=t[o].get(c);if(!v)continue;const g=e[o]*v.nav;d+=g,f.push({fundIdx:o,nav:v.nav,when:v.date,units:e[o],amount:g,type:"sell",cumulativeUnits:e[o],currentValue:g,allocationPercentage:0})}return l.forEach(o=>{o.allocationPercentage=i>0?o.currentValue/i*100:0}),f.forEach(o=>{o.allocationPercentage=d>0?o.currentValue/d*100:0}),l.push(...f),l}function z(t,e,n,r){const s=[],a=w(e);for(let l=0;l<t.length;l++){const u=t[l].get(a);if(!u)return null;const c=r*n[l]/100;s[l]=c/u.nav}return s}function ct(t,e,n){let r=0;const s=w(e);for(let a=0;a<t.length;a++){const l=t[a].get(s);if(!l)return null;r+=n[a]*l.nav}return r}function it(t,e,n,r){try{return U([{amount:-t,when:n},{amount:e,when:r}])}catch{return null}}function ut(t,e,n,r,s,a,l){const u=[],c=w(s),i=w(a),d=r.filter(f=>f.date>=s&&f.date<=a);for(const f of d){const o=w(f.date),v=o===c,g=o===i;let p=0;const m=[];for(let h=0;h<t.length;h++){const y=t[h].get(o);if(!y)continue;const M=e[h]*y.nav;p+=M;const D=l*n[h]/100;let T="nil",E=0,N=0;v?(T="buy",E=-D,N=e[h]):g&&(T="sell",E=M,N=e[h]),m.push({fundIdx:h,nav:y.nav,when:y.date,units:N,amount:E,type:T,cumulativeUnits:e[h],currentValue:M,allocationPercentage:0})}m.forEach(h=>{h.allocationPercentage=p>0?h.currentValue/p*100:0}),u.push(...m)}return u}function ht(t,e,n,r,s=100){if(!$(t))return null;const a=t.length,l=r.length===a?r:Array(a).fill(100/a),u=t.map(O),c=u.map(C),i=j(u[0]),d=i[0].date,f=n*12,o=K(e,f);if(o<d)return null;const v=z(c,o,l,s);return v?ut(c,v,l,i,o,e,s):null}export{ft as calculateLumpSumRollingXirr,ht as recalculateLumpsumTransactionsForDate};
//# sourceMappingURL=index-59183fe4.js.map
